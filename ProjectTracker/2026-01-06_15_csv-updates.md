# 2026-01-06_15_csv-updates.md
# Step 15: Update All Seed Data CSV Files

## Metadata
- **Order**: 15 of 16
- **Estimated Time**: 10 minutes
- **Dependencies**: Step 14 (migration)
- **Creates**: Updated CSV files in `prisma/seed/rawData/`

## Purpose
Update all CSV seed files with new test patients and meal-time data.

---

## Prompt for LLM

Replace each CSV file with the content below. Pay careful attention to the new `suitable_meal_times` column in recipes.

### 1. Replace `prisma/seed/rawData/diet_orders.csv`:
```csv
id,name,minimum_calories,maximum_calories
aa2453c7-f6d2-4719-8719-bf74bf98896b,Regular,1500,2500
f5f6e246-0cf6-4eb6-a6f1-fcb894c888ce,Low Calorie,1000,1500
9927c08e-9749-4871-961b-0edcdd65a6cb,High Calorie,2000,2500
```

*(No changes - keeping for reference)*

---

### 2. Replace `prisma/seed/rawData/patients.csv`:
```csv
id,name
7ea4e6ec-f359-485b-ac99-e0b44c3e18b9,Mark Corrigan
a1b2c3d4-e5f6-7890-abcd-ef1234567890,Sophie Chapman
c3d4e5f6-a7b8-9012-cdef-123456789012,Alan Johnson
```

**New patients:**
- Sophie Chapman - NO diet order (tests default handling)
- Alan Johnson - High Calorie diet (tests catch-up)

---

### 3. Replace `prisma/seed/rawData/patient_diet_orders.csv`:
```csv
id,patient_id,diet_order_id
b0c9bc83-48d5-4039-aff3-1ccb510e8e5f,7ea4e6ec-f359-485b-ac99-e0b44c3e18b9,aa2453c7-f6d2-4719-8719-bf74bf98896b
e5f6a7b8-c9d0-1234-ef01-345678901234,c3d4e5f6-a7b8-9012-cdef-123456789012,9927c08e-9749-4871-961b-0edcdd65a6cb
```

**Note:** Sophie Chapman intentionally has NO entry here!

| Patient | Diet Order |
|---------|------------|
| Mark Corrigan | Regular (1500-2500) |
| Sophie Chapman | **NONE** |
| Alan Johnson | High Calorie (2000-2500) |

---

### 4. Replace `prisma/seed/rawData/recipes.csv`:
```csv
id,name,category,calories,suitable_meal_times
ad3de666-05e4-416c-a7d4-a5c5cf79d6f4,Water,Beverages,0,BREAKFAST,LUNCH,DINNER
6bad53cc-89fa-403b-844a-70926fa9b00f,Chocolate Ensure,Beverages,200,BREAKFAST
3e511232-c761-4045-b7ef-2d739c065a33,Vanilla Ensure,Beverages,200,BREAKFAST
9f575340-9fba-4e93-9427-ac0a91504417,Coffee,Beverages,10,BREAKFAST,LUNCH
15c8ac77-128e-4825-960e-eb5638376e00,Pancakes,Entrees,350,BREAKFAST
3f6cb45d-e813-4e67-be9c-9f78b597bdbc,Bacon,Entrees,250,BREAKFAST
9e329204-a9d3-445b-ad6d-5eeb6456af66,Hash Browns,Sides,150,BREAKFAST
3080a02c-d6a9-4634-8878-711920f11a66,Caesar Salad,Entrees,500,LUNCH,DINNER
89f0fc07-045e-425c-aeef-f092562fc8c9,Turkey Sandwich,Entrees,500,LUNCH,DINNER
99b9a31e-e1fc-4fd9-9897-854f90acf3bb,Tomato Soup,Entrees,400,LUNCH,DINNER
385079f9-d049-48e2-9093-5bdcf328282f,Salmon,Entrees,450,LUNCH,DINNER
a2b3c4d5-e6f7-8901-2345-6789abcdef01,Grilled Chicken,Entrees,550,LUNCH,DINNER
b3c4d5e6-f7a8-9012-3456-789abcdef012,Pasta Primavera,Entrees,600,LUNCH,DINNER
59f4f0b4-2075-40a4-b95b-883433eed1a2,Mixed Veggies,Sides,200,LUNCH,DINNER
0b9c16f1-d4c0-40c8-8b7a-3d4a50f653ad,Mashed Potatoes,Sides,150,LUNCH,DINNER
c4d5e6f7-a8b9-0123-4567-89abcdef0123,Dinner Roll,Sides,120,LUNCH,DINNER
cc6ae954-43a8-46da-8bbd-3548ae87cf01,Chocolate Pudding,Desserts,150,LUNCH,DINNER
52e1fc08-59b3-4ecc-a8a4-93144566b932,Apple Pie,Desserts,150,LUNCH,DINNER
d5e6f7a8-b9c0-1234-5678-9abcdef01234,Fruit Cup,Desserts,80,BREAKFAST,LUNCH,DINNER
```

**Changes:**
- Added `suitable_meal_times` column to ALL recipes
- Added new recipes: Grilled Chicken (550), Pasta Primavera (600), Dinner Roll (120), Fruit Cup (80)
- Breakfast-only: Pancakes, Bacon, Hash Browns, Chocolate Ensure, Vanilla Ensure
- Breakfast+Lunch: Coffee
- Lunch+Dinner: All salads, sandwiches, soups, main dishes
- All meals: Water, Fruit Cup

---

### 5. Replace `prisma/seed/rawData/tray_orders.csv`:
```csv
id,scheduled_for,meal_time,patient_id
f0b92e3d-889a-4d70-b40e-b062a497b0da,2025-08-24 08:00:00.000,BREAKFAST,7ea4e6ec-f359-485b-ac99-e0b44c3e18b9
82522b47-685a-48ce-9b89-e21f37027214,2025-08-24 12:00:00.000,LUNCH,7ea4e6ec-f359-485b-ac99-e0b44c3e18b9
22222222-2222-2222-2222-222222222222,2025-08-24 08:00:00.000,BREAKFAST,c3d4e5f6-a7b8-9012-cdef-123456789012
```

**Summary:**
| Patient | Existing Orders |
|---------|-----------------|
| Mark Corrigan | BREAKFAST, LUNCH |
| Sophie Chapman | **NONE** |
| Alan Johnson | BREAKFAST only (low calorie) |

---

### 6. Replace `prisma/seed/rawData/tray_order_recipes.csv`:
```csv
id,tray_order_id,recipe_id
2f8625e0-8b7b-4fb1-a32b-5f98b578af6c,f0b92e3d-889a-4d70-b40e-b062a497b0da,15c8ac77-128e-4825-960e-eb5638376e00
9c5e0cdc-965a-43a9-a250-ef88d2039d22,f0b92e3d-889a-4d70-b40e-b062a497b0da,9e329204-a9d3-445b-ad6d-5eeb6456af66
86ecad06-654f-4756-b0e2-0c132ec96fbc,82522b47-685a-48ce-9b89-e21f37027214,89f0fc07-045e-425c-aeef-f092562fc8c9
bbbb1111-bbbb-bbbb-bbbb-bbbbbbbbbbbb,22222222-2222-2222-2222-222222222222,9f575340-9fba-4e93-9427-ac0a91504417
```

**Calorie breakdown:**
| Patient | Meal | Recipes | Calories |
|---------|------|---------|----------|
| Mark | BREAKFAST | Pancakes (350) + Hash Browns (150) | **500** |
| Mark | LUNCH | Turkey Sandwich (500) | **500** |
| Alan | BREAKFAST | Coffee (10) | **10** |

**Key insight:** Alan has only consumed 10 calories. His High Calorie diet requires 2000-2500 daily. The system must give him ~1990-2490 more calories across LUNCH and DINNER.

---

## After Updating CSVs

Run these commands to rebuild the database:
```bash
# Reset and reseed the database
npm run db-clean
npm run db-up

# Wait for postgres (check status)
docker ps

# Regenerate Prisma client
npx prisma generate

# Push schema and seed data
npx prisma db push
npm run reset-db
```

---

## Validation Checklist
- [ ] All 6 CSV files updated
- [ ] `npm run db-clean` succeeds
- [ ] `npm run db-up` succeeds
- [ ] `npx prisma generate` succeeds
- [ ] `npx prisma db push` succeeds
- [ ] `npm run reset-db` succeeds
- [ ] Query shows 3 patients: `SELECT * FROM patients;`
- [ ] Query shows 2 patient_diet_orders (NOT 3)
- [ ] Query shows 3 tray_orders
- [ ] Query shows 19 recipes with suitable_meal_times column