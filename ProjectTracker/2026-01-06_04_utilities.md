# 2026-01-06_04_utilities.md
# Step 04: Logger & DateTime Utilities

## Metadata
- **Order**: 04 of 11
- **Estimated Time**: 10 minutes
- **Dependencies**: None
- **Creates**:
  - `src/utils/logger.ts`
  - `src/utils/dateTimeUtils.ts`

## Purpose
Create foundational utilities used by all other modules.

---

## Prompt for LLM
```
Create two utility files:

### 1. Create `src/utils/logger.ts`:

Structured JSON logger for healthcare audit compliance.

Header comment explaining why logging matters in healthcare:
- Audit compliance
- Incident investigation
- Quality improvement

Type LogLevel = 'INFO' | 'WARN' | 'ERROR'

Interface LogEntry:
- timestamp: string (ISO format)
- level: LogLevel
- component: string
- message: string
- data?: Record<string, unknown>

Create formatLog function that returns JSON.stringify(entry)

Export createLogger factory function that takes component name and returns:
- info(message, data?) - uses console.log
- warn(message, data?) - uses console.warn
- error(message, data?) - uses console.error

Each method creates LogEntry with timestamp, level, component, message, data.

### 2. Create `src/utils/dateTimeUtils.ts`:

Date/time utilities for meal scheduling with simulation support.

Import MealTime from @prisma/client
Import MEAL_SERVICE_TIMES, ADVANCE_ORDER_HOURS from config

Functions to create:

getStartOfDay(date: Date): Date
- Returns new Date with hours/mins/secs/ms set to 0

getMealDateTime(date: Date, mealTime: MealTime): Date
- Returns DateTime for specific meal on specific date
- Throws if mealTime not in MEAL_SERVICE_TIMES (handles SNACK)

getMealsRequiringOrders(currentTime: Date): MealTime[]
- Returns meals where current time is within ordering window
- Window: ADVANCE_ORDER_HOURS before meal until meal time
- Only process BREAKFAST, LUNCH, DINNER - never SNACK
- Include detailed example in comment: "At 5:30 AM with 3-hour lead: Breakfast 8-3=5, we're past 5, so INCLUDE"

isSameDay(date1: Date, date2: Date): boolean
- Compare year, month, date

All functions should have JSDoc comments with examples.
```

---

## Validation Checklist
- [ ] `src/utils/logger.ts` created
- [ ] `src/utils/dateTimeUtils.ts` created
- [ ] Logger outputs valid JSON
- [ ] getMealsRequiringOrders excludes SNACK
- [ ] No TypeScript errors