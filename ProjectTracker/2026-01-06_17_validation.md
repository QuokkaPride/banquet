# 2026-01-06_17_validation.md
# Step 17: Final Data Validation

## Metadata
- **Order**: 17 of 16 (bonus)
- **Estimated Time**: 5 minutes
- **Dependencies**: Steps 13-16
- **Creates**: Nothing (validation only)

## Purpose
Verify all seed data loaded correctly before implementing smart ordering logic.

---

## Validation Commands

Run these queries to confirm your test data is correct:
```bash
# Start database if not running
npm run db-up

# Reset to clean state with new seed data
npm run reset-db
```

Then connect to database and run these queries:

### Check Patients (should be 3):
```sql
SELECT id, name FROM patients ORDER BY name;
```

Expected:
| id | name |
|----|------|
| c3d4e5f6... | Alan Johnson |
| 7ea4e6ec... | Mark Corrigan |
| a1b2c3d4... | Sophie Chapman |

### Check Diet Orders Assignments (should be 2, NOT 3):
```sql
SELECT p.name, d.name as diet, d.minimum_calories, d.maximum_calories
FROM patients p
LEFT JOIN patient_diet_orders pdo ON p.id = pdo.patient_id
LEFT JOIN diet_orders d ON pdo.diet_order_id = d.id
ORDER BY p.name;
```

Expected:
| name | diet | min | max |
|------|------|-----|-----|
| Alan Johnson | High Calorie | 2000 | 2500 |
| Mark Corrigan | Regular | 1500 | 2500 |
| Sophie Chapman | NULL | NULL | NULL |

### Check Existing Tray Orders (should be 3):
```sql
SELECT p.name, t.meal_time, t.scheduled_for
FROM tray_orders t
JOIN patients p ON t.patient_id = p.id
ORDER BY p.name, t.meal_time;
```

Expected:
| name | meal_time | scheduled_for |
|------|-----------|---------------|
| Alan Johnson | BREAKFAST | 2025-08-24 08:00:00 |
| Mark Corrigan | BREAKFAST | 2025-08-24 08:00:00 |
| Mark Corrigan | LUNCH | 2025-08-24 12:00:00 |

### Check Calories Consumed:
```sql
SELECT p.name, t.meal_time, SUM(r.calories) as calories
FROM tray_orders t
JOIN patients p ON t.patient_id = p.id
JOIN tray_order_recipes tor ON t.id = tor.tray_order_id
JOIN recipes r ON tor.recipe_id = r.id
GROUP BY p.name, t.meal_time
ORDER BY p.name, t.meal_time;
```

Expected:
| name | meal_time | calories |
|------|-----------|----------|
| Alan Johnson | BREAKFAST | 10 |
| Mark Corrigan | BREAKFAST | 500 |
| Mark Corrigan | LUNCH | 500 |

### Check Recipes Have Meal Times:
```sql
SELECT name, category, calories, suitable_meal_times
FROM recipes
ORDER BY category, name;
```

Should show 19 recipes with `suitable_meal_times` populated.

---

## What's Missing (What Smart Ordering Must Create)

| Patient | Missing Meals | Calories Consumed | Calories Needed |
|---------|---------------|-------------------|-----------------|
| Mark Corrigan | DINNER | 1000 | 500-1500 more |
| Sophie Chapman | BREAKFAST, LUNCH, DINNER | 0 | Use defaults |
| Alan Johnson | LUNCH, DINNER | 10 | 1990-2490 more |

---

## Validation Checklist
- [ ] 3 patients exist
- [ ] Only Mark and Alan have diet orders (NOT Sophie)
- [ ] 3 tray orders exist (Mark 2, Alan 1, Sophie 0)
- [ ] Alan's breakfast = 10 calories (just coffee)
- [ ] Mark's consumed = 1000 calories
- [ ] 19 recipes with suitable_meal_times column
- [ ] Ready to implement triggerSmartOrderSystem()